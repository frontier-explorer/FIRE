<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREシミュレーション</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .utility-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        /* サンプルデータ入力ボタンを強調 */
        #loadSampleDataBtn {
            background-color: #27ae60; /* 緑系 */
            color: white;
            flex-grow: 1;
            max-width: 300px;
        }
        #clearDataBtn {
            background-color: #e74c3c; /* 赤系 */
            color: white;
            flex-grow: 1;
            max-width: 300px;
        }
        #exportDataLink {
            background-color: #27ae60; /* 緑系 */
            color: white;
            flex-grow: 1;
            max-width: 300px;
        }
        #importDataBtn {
            background-color: #e74c3c; /* 赤系 */
            color: white;
            flex-grow: 1;
            max-width: 300px;
        }

        .app-info {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <header>
        <h1>FIREシミュレーション</h1>
        <p>あなたの財務データに基づき、FIRE達成の可能性をモンテカルロ・シミュレーションで検証します。</p>
    </header>

        <div class="app-info">
            <h3>アプリの使い方</h3>
            <ol>
                <li>まずは「基本設定」からシミュレーション期間などを設定してください。</li>
                <li>次に、「保有証券」や「相関係数」などの詳細なデータを入力してください。</li>
                <li>全ての準備ができたら、「シミュレーション実行」から結果を確認できます。</li>
                <li>※入力方法がわからないときは、画面一番下にある、緑色の「サンプルデータの入力」ボタンを押して、入力のイメージをつかんでください。おおむね入力する内容がわかったら赤色の「データをクリアする」ボタンを押して自分の金融資産を入力してください。</li>

            </ol>
        </div>

    <main>
        <div class="navigation-container">
            <h2>設定項目</h2>
            <nav>
                <ul>
                    <li><a href="config.html" class="nav-button">基本設定</a></li>
                    <li><a href="stocks.html" class="nav-button">保有証券</a></li>
                    <li><a href="soukan.html" class="nav-button">相関係数</a></li>
                    <li><a href="tuika.html" class="nav-button">追加投資</a></li>
                    <li><a href="life_cost.html" class="nav-button">生活費</a></li>
                    <li><a href="big_expense.html" class="nav-button">大きな出費</a></li>
                    <li><a href="income.html" class="nav-button">収入設定</a></li>
                    <li><a href="tax.html" class="nav-button">税金設定</a></li>
                </ul>
            </nav>
		<br>
            <nav>
	        <div class="utility-actions">
			<a href="#" id="exportDataLink" class="nav-button action-button">設定ファイルをエクスポート</a>
			<button id="importDataBtn" class="nav-button action-button">設定ファイルを読み込む</button>
		</div>
            </nav>
		<br>
            <a href="simulate.html" id="simulateLink" class="nav-button simulate-button" style="margin-top: 20px;">シミュレーション実行</a>
        </div>
        
        <div class="utility-actions">
            <button id="loadSampleDataBtn" class="nav-button" type="button">サンプルデータの入力</button>
            <button id="clearDataBtn" class="nav-button" type="button">データをクリアする</button>
        </div>
        
    </main>



    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadSampleDataBtn = document.getElementById('loadSampleDataBtn');
            const clearDataBtn = document.getElementById('clearDataBtn');
            const simulateLink = document.getElementById('simulateLink');

            // 1. サンプルデータ (FIRE_Settings_Export.jsonの内容を反映)
            const sampleData = {

"config":{"period":50,"times":1000,"birthDate":"2000-01-01","cash":5000000,"inflationRate":2},"stocks":[{"Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","Kuchisu":10000000,"Tani":10000,"CurrentValuePerUnit":36200,"AveragePrice":20000,"Return":8,"Volatility":15,"TaxStartYear":0,"TaxStartMonth":1},{"Meigara":"ニッセイＮＡＳＤＡＱ１００インデックスファンド＜特定＞","Kuchisu":1000000,"Tani":10000,"CurrentValuePerUnit":21700,"AveragePrice":18000,"Return":12,"Volatility":20,"TaxStartYear":0,"TaxStartMonth":1},{"Meigara":"ＳＢＩ・Ｖ・Ｓ＆Ｐ５００インデックス・ファンド＜特定＞","Kuchisu":4000000,"Tani":10000,"CurrentValuePerUnit":33080,"AveragePrice":17000,"Return":8,"Volatility":15,"TaxStartYear":0,"TaxStartMonth":1},{"Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜成長(新NISA)＞","Kuchisu":700000,"Tani":10000,"CurrentValuePerUnit":36200,"AveragePrice":34561,"Return":8,"Volatility":15,"TaxStartYear":null,"TaxStartMonth":null},{"Meigara":"ニッセイＮＡＳＤＡＱ１００インデックスファンド＜成長(新NISA)＞","Kuchisu":1700000,"Tani":10000,"CurrentValuePerUnit":21700,"AveragePrice":13928,"Return":12,"Volatility":20,"TaxStartYear":null,"TaxStartMonth":null},{"Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜積立(新NISA)＞","Kuchisu":850000,"Tani":10000,"CurrentValuePerUnit":36200,"AveragePrice":28555,"Return":8,"Volatility":15,"TaxStartYear":null,"TaxStartMonth":null},{"Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜旧NISA＞","Kuchisu":120000,"Tani":10000,"CurrentValuePerUnit":36200,"AveragePrice":22523,"Return":8,"Volatility":15,"TaxStartYear":18,"TaxStartMonth":1},{"Meigara":"ＳＢＩ・Ｖ・Ｓ＆Ｐ５００インデックス・ファンド＜旧NISA＞","Kuchisu":300000,"Tani":10000,"CurrentValuePerUnit":33080,"AveragePrice":17560,"Return":8,"Volatility":15,"TaxStartYear":18,"TaxStartMonth":1}],"soukan":[{"A_Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","B_Meigara":"ニッセイＮＡＳＤＡＱ１００インデックスファンド＜特定＞","keisu":0.95},{"A_Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","B_Meigara":"ＳＢＩ・Ｖ・Ｓ＆Ｐ５００インデックス・ファンド＜特定＞","keisu":0.99999},{"A_Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","B_Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜成長＞","keisu":1},{"A_Meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","B_Meigara":"ニッセイＮＡＳＤＡＱ１００インデックスファンド＜特定＞","keisu":0.95},{"A_Meigara":"ニッセイＮＡＳＤＡＱ１００インデックスファンド＜特定＞","B_Meigara":"ＳＢＩ・Ｖ・Ｓ＆Ｐ５００インデックス・ファンド＜特定＞","keisu":0.95}],"tuika":[{"month":12,"meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","amount":100000},{"month":24,"meigara":"ｅＭＡＸＩＳ　Ｓｌｉｍ　米国株式（Ｓ＆Ｐ５００）＜特定＞","amount":100000}],"lifeCost":[{"month":1,"amount":200000},{"month":121,"amount":300000}],"bigExpense":[{"month":120,"amount":5000000,"reason":"車を買う"},{"month":180,"amount":5000000,"reason":"家の修繕費"}],"income":[{"startTotalMonths":120,"endTotalMonths":null,"amount":100000,"reason":"年金"}],"tax":[{"month":1,"rate":20.315}]}
;

            // 2. サンプルデータ読み込み機能
            loadSampleDataBtn.addEventListener('click', () => {
                if (confirm('現在の設定データは上書きされます。サンプルデータを読み込みますか？')) {
                    // Local Storageにサンプルデータを保存
                    localStorage.setItem('fireSimulatorData', JSON.stringify(sampleData));
                    alert('サンプルデータが読み込まれました！\n各設定画面で内容をご確認後、「シミュレーション実行」へ進んでください。');
                    // ページをリロードして変更を反映
                    window.location.reload();
                }
            });

            // 3. データクリア機能（追加）
            clearDataBtn.addEventListener('click', () => {
                if (confirm('Local Storageに保存されている全ての設定データ（基本設定、保有証券など）を削除しますか？')) {
                    localStorage.removeItem('fireSimulatorData');
                    alert('設定データがクリアされました。');
                    // ページをリロードして変更を反映
                    window.location.reload();
                }
            });


            // (既存のシミュレーション実行時のバリデーションロジック)
            simulateLink.addEventListener('click', (event) => {
                let dataString = localStorage.getItem('fireSimulatorData');
                let appData;

                // 1. データが存在するかチェック
                if (!dataString) {
                    event.preventDefault(); // 遷移を阻止
                    alert('設定データが保存されていません。全ての必須項目を設定してから実行してください。');
                    return;
                }

                // 2. データが有効なJSONかチェック
                try {
                    appData = JSON.parse(dataString);
                } catch (e) {
                    event.preventDefault(); // 遷移を阻止
                    alert('設定データが壊れています。データをクリアして再度設定し直すか、「設定ファイルを読み込む」で正しいファイルをロードしてください。');
                    return;
                }

                // 3. 最低限必要なデータ（configとstocks）が存在するかチェック
                const hasConfig = appData.config && appData.config.period > 0 && appData.config.times > 0;
                const hasStocks = appData.stocks && appData.stocks.length > 0;

                if (!hasConfig || !hasStocks) {
                    event.preventDefault(); // 遷移を阻止
                    let message = 'シミュレーションに必要なデータが不足しています。\n\n';
                    if (!hasConfig) {
                        message += '・「基本設定」でシミュレーション期間や試行回数が設定されていません。\n';
                    }
                    if (!hasStocks) {
                        message += '・「保有証券」が登録されていません。\n';
                    }
                    message += '\n設定ページに戻り、全ての必須項目を入力してください。';
                    alert(message);
                    return;
                }

                // データが揃っていれば、そのまま遷移を許可
            });


            // (既存のエクスポート/インポート機能のロジック)

            // エクスポート機能
            document.getElementById('exportDataLink').addEventListener('click', function (e) {
                const data = localStorage.getItem('fireSimulatorData');
                if (!data || data === '{}') {
                    e.preventDefault();
                    alert('エクスポートする設定データがありません。');
                    return;
                }
                
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                e.currentTarget.href = url;
                e.currentTarget.download = 'FIRE_Settings_Export.json';
                // ダウンロード後、URLを解放
                setTimeout(() => URL.revokeObjectURL(url), 100);
            });

            // インポート機能
            document.getElementById('importDataBtn').addEventListener('click', function () {
                // ファイル入力エレメントを動的に作成
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.json'; // JSONファイルのみを受け付ける

                fileInput.onchange = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const content = e.target.result;
                            const newAppData = JSON.parse(content);
                            
                            // 必須チェック: FIREシミュレータのデータ構造か確認（最低限configがあるか）
                            if (!newAppData || typeof newAppData !== 'object' || !newAppData.config) {
                                alert('エラー: ファイルの内容が正しくありません。FIREシミュレータの設定ファイルであることを確認してください。');
                                return;
                            }

                            // Local Storageに上書き保存
                            localStorage.setItem('fireSimulatorData', JSON.stringify(newAppData));
                            
                            alert('設定ファイルを読み込み、Local Storageに保存しました！\n各設定画面で内容をご確認ください。');
                            
                            // 読み込み後、メイン画面をリロードして反映
                            window.location.reload(); 

                        } catch (error) {
                            alert('ファイルの解析に失敗しました。ファイルが破損しているか、JSON形式ではありません。');
                            console.error('File load error:', error);
                        }
                    };
                    // ファイルをテキスト（文字列）として読み込む
                    reader.readAsText(file);
                };
                // 隠されたinput要素をクリックしてファイル選択ダイアログを表示
                fileInput.click();
            });

        });
    </script>
</body>
</html>