<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREシミュレーション</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>FIREシミュレーション</h1>
        <p>あなたの財務データに基づき、FIRE達成の可能性をモンテカルロ・シミュレーションで検証します。</p>
    </header>

    <main>
        <div class="navigation-container" style="background-color: #f7f9fc; padding: 20px; margin-bottom: 25px; border-radius: 8px;">
            <h2>📊 なんで「わかりづらいシミュレーションアプリ」を使うべきなの？</h2>
            <p style="text-align: left; line-height: 1.6; font-size: 1.1em;">
                多くのシンプルな計算ツールは「毎年〇%のリターンが固定で得られる」という前提（単一の直線）でシミュレーションを行います。<br>しかし、実際の投資市場には「景気の波」があり、毎年リターンが変動します。
<br>このように、ありないシミュレーションで複利的な資産の増え方を理解しても、それは残念ながら都合の良い妄想でしかなく、その都合の良い妄想で実際にFIREをしたら痛い目を見るかもしれません。
<br>このシミュレーションの目的は、そのような不幸な人を出さないために作ったものです。
            </p>
            <p style="text-align: left; line-height: 1.6; font-size: 1.1em; font-weight: bold;">
                FIRE計画においては、<span style="color: #c0392b;">市場が思ったように成長しない・暴落・乱高下</span>している中でも、生活出費が発生することが致命的な資産枯渇（FIRE失敗）につながる最大の要因です。
            </p>
            <p style="text-align: left; line-height: 1.6;">
                このシミュレーションは、何千通りもの「乱高下する可能性のある未来」を計算し、そのうち何%のケースで資産が枯渇せずに目標を達成できるかを検証します。
		<br>
		１０００回を１度にできるシミュレーション回数としていますが、それを何十回と繰り返して、合計数万回のシミュレーションによる成功確率の終息値を探ってください。
            </p>
            <center style="margin: 20px 0;">
                
            </center>
            <p style="text-align: left; line-height: 1.6; font-style: italic; font-size: 0.9em;">
                本シミュレーションは、「最悪のタイミングでFIREした場合でも計画が耐えうるか」を科学的に評価するためにモンテカルロ法を採用しています。
            </p>
        </div>
        <div class="navigation-container">
            <h2>設定項目</h2>
            <nav>
                <ul>
                    <li><a href="config.html" class="nav-button">基本設定</a></li>
                    <li><a href="stocks.html" class="nav-button">保有証券</a></li>
                    <li><a href="soukan.html" class="nav-button">相関係数</a></li>
                    <li><a href="tuika.html" class="nav-button">追加投資</a></li>
                    <li><a href="life_cost.html" class="nav-button">生活費</a></li>
                    <li><a href="big_expense.html" class="nav-button">大きな出費</a></li>
                    <li><a href="income.html" class="nav-button">収入</a></li>
                    <li><a href="tax.html" class="nav-button">税金</a></li>
                </ul>
		<br>
		<br>
                <ul style="display: flex; flex-direction: column; gap: 10px;">
                    <li style="display: flex; gap: 10px;">
                        <button onclick="loadAllSettings()" class="nav-button" style="background-color: #3498db; color: white; flex: 1;">設定ファイルを読み込む</button>
                        <button onclick="downloadAllSettings()" class="nav-button" style="background-color: #f39c12; color: white; flex: 1;">設定をファイルに書き出す</button>
                    </li>
                    <li style="display: flex; gap: 10px;">
                        <button onclick="clearAllSettings()" class="nav-button" style="background-color: #c0392b; color: white; flex: 1;">全ての設定をクリア</button>
                    </li>
                </ul>
            </nav>
        </div>
        
        <div class="navigation-container simulation-link">
            <h2>シミュレーション</h2>
            <nav>
                <ul style="display: flex; flex-direction: column; gap: 10px;">
                    <li><a href="simulate.html" class="nav-button">シミュレーション実行</a></li>
                </ul>
            </nav>
        </div>

        <div class="app-info">
            <h3>アプリの使い方</h3>
            <ol>
                <li>まずは「基本設定」からシミュレーション期間などを設定してください。</li>
                <li>次に、「保有証券」や「相関係数」などの詳細なデータを入力してください。</li>
                <li>全ての準備ができたら、「シミュレーション実行」から結果を確認できます。</li>
            </ol>
        </div>
    </main>

    <script src="app.js"></script>

    <script>
        function clearAllSettings() {
            const isConfirmed = confirm('⚠️ 警告: ローカルに保存されている全てのシミュレーション設定データを完全に削除します。この操作は元に戻せません。よろしいですか？');

            if (isConfirmed) {
                // 設定データが保存されているキーを削除
                localStorage.removeItem('fireSimulatorData');
                
                alert('全ての設定データが正常にクリアされました。\n新しい設定を開始できます。');
                
                // ページをリロードして、クリア後の状態を反映させる
                window.location.reload(); 
            }
        }



        document.addEventListener('DOMContentLoaded', () => {
            const simulationLink = document.querySelector('a[href="simulate.html"]');
            
            if (simulationLink) {
                simulationLink.addEventListener('click', function(event) {
                    const dataString = localStorage.getItem('fireSimulatorData');
                    let appData = null;

                    // 1. データ自体が存在するかチェック
                    if (!dataString) {
                        event.preventDefault(); // 遷移を阻止
                        alert('シミュレーションに必要な設定データがありません。\n\n「設定ファイルを読み込む」でデータをロードするか、または「基本設定」「保有証券」などのページで各種設定を行ってください。');
                        return;
                    }

                    // 2. データが有効なJSONかチェック
                    try {
                        appData = JSON.parse(dataString);
                    } catch (e) {
                        event.preventDefault(); // 遷移を阻止
                        alert('設定データが壊れています。データをクリアして再度設定し直すか、「設定ファイルを読み込む」で正しいファイルをロードしてください。');
                        return;
                    }

                    // 3. 最低限必要なデータ（configとstocks）が存在するかチェック
                    // config (シミュレーション期間など) と stocks (銘柄情報) が最低限必要と仮定
                    const hasConfig = appData.config && appData.config.period > 0 && appData.config.times > 0;
                    const hasStocks = appData.stocks && appData.stocks.length > 0;

                    if (!hasConfig || !hasStocks) {
                        event.preventDefault(); // 遷移を阻止
                        let message = 'シミュレーションに必要なデータが不足しています。\n\n';
                        if (!hasConfig) {
                            message += '・「基本設定」でシミュレーション期間や試行回数が設定されていません。\n';
                        }
                        if (!hasStocks) {
                            message += '・「保有証券」が登録されていません。\n';
                        }
                        message += '\n設定ページに戻り、全ての必須項目を入力してください。';
                        alert(message);
                        return;
                    }

                    // データが揃っていれば、そのまま遷移を許可
                });
            }
        });
    </script>

</body>
</html>