<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREシミュレーション</title>
    <style>
        /* デザイン - ブラウザサイズまで広げ、収まらないときは垂直・水平スライダーで表示 */
        body {
            max-width: none !important;
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f7;
            color: #333;
            min-width: 1000px;
            /* 横スクロールを発生させやすくするための最小幅 */
        }

        h1,
        h2 {
            text-align: center;
            color: #2c3e50;
        }

        .simulation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            /* ボタン間の間隔を調整 */
            justify-content: flex-start;
            /* 左揃え */
            margin-top: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .simulation-button {
            /* 試行回数の数字のみをテキストとするボタンを横に最大25個、左揃えで均等配置。 */
            flex-basis: calc(3%);
            /* 5pxのギャップで25個並べるための計算 */
            height: 30px;
            border-radius: 5px;
            border: 1px solid #ccc;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease;
            text-align: center;
            line-height: 30px;
            font-size: 12px;
            padding: 0;
        }

        /* 4.2. 成功/失敗ボタン */
        .success {
            background-color: #3498db;
        }

        /* 青色: FIRE成功 */
        .failure {
            background-color: #e74c3c;
        }

        /* 赤色: FIRE失敗 */
        .simulation-button:hover {
            opacity: 0.8;
        }

        /* 4.3. シミュレーション詳細テーブルのデザイン */
        #detail-table-container {
            width: 100%;
            overflow-x: auto;
            /* 水平スクロール */
            margin-top: 30px;
            border: 1px solid #ccc;
            background-color: #fff;

            /* スクロール範囲を限定するために高さを指定 */
            height: 500px;
            /* 縦スクロールを有効にする */
            overflow-y: scroll;
        }

        #detail-table {
            width: 100%;
            font-size: 12px;
            table-layout: fixed;
            /* カラム幅を固定 */
        }

        /* 4.3. テーブル固定表示: テーブルの見出し（2行構成）は、縦スクロールしても常に最上部に表示されるよう固定。 */
        #detail-table thead {
            background-color: #f9f9f9;
            /* 見出しの背景色 */
        }

        #detail-table th,
        #detail-table td {
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
            /* セル内の改行を防ぐ（thは改行タグで制御） */
        }

        #detail-table th {
            background-color: #e9ecef;
            color: #495057;
            text-align: center;
            vertical-align: middle;
        }

        /* 共通項目のカラム幅を固定 */
        #detail-table tr th:nth-child(1),
        #detail-table tr td:nth-child(1) {}

        /* (1) 年月 */
        #detail-table th:nth-child(2),
        #detail-table td:nth-child(2) {}

        /* (2) 引継金融資産額 */
        #detail-table th:nth-child(3),
        #detail-table td:nth-child(3) {}

        /* (3) 出費 */
        #detail-table th:nth-child(4),
        #detail-table td:nth-child(4) {}

        /* (4) 収入 */
        #detail-table th:nth-child(5),
        #detail-table td:nth-child(5) {}

        /* (5) 税金 */
        #detail-table th:nth-child(6),
        #detail-table td:nth-child(6) {}

        /* (6) 保有現金 */
        #detail-table th:nth-child(7),
        #detail-table td:nth-child(7) {}

        /* (7) 追加投資 */
        #detail-table th:nth-child(8),
        #detail-table td:nth-child(8) {}

        /* (8) 期末金融資産額 */
        #detail-table th:nth-child(9),
        #detail-table td:nth-child(9) {}

        /* (9) 総資産 */

        /* 銘柄ごとの詳細カラム幅の固定 (4列: 60 + 100 + 100 + 130 = 390px) */
        /* 銘柄ごとの詳細列は10列目から開始 */
        #detail-table td:nth-child(4n + 10) {}

        /* 利率% */
        #detail-table td:nth-child(4n + 11) {}

        /* 金融資産額 */
        #detail-table td:nth-child(4n + 12) {}

        /* 保有口数の残数 */
        #detail-table td:nth-child(4n + 13) {}

        /* 現在/平均（税金/1口あたり） */


        /* 1. <thead>内の1行目（#header-row-1）のセルを固定 */
        /* <thead> > tr:nth-child(1) の中の th, td */
        #detail-table thead tr:nth-child(1) th,
        #detail-table thead tr:nth-child(1) td {
            /*固定位置を一番上 (0px) に設定 */
            position: sticky;
            top: 0;
            /*重なり順を設定 (固定部分を上に表示) */
            z-index: 20;
            /* 見やすくするために背景色を設定 */
            background-color: #f2f2f2;
        }

        /* 2. <thead>内の2行目（#header-row-2）のセルを、1行目の直下に固定 */
        /* <thead> > tr:nth-child(2) の中の th, td */
        #detail-table thead tr:nth-child(2) th,
        #detail-table thead tr:nth-child(2) td {
            position: sticky;
            top: 21px;
            background-color: #e6ffe6;
            z-index: 10;
        }

        /* <tr>2のセルは、<tr>1のセルの直下に固定されるように、topを調整します */
        /* <tr>1の高さが40pxだと仮定して設定 (実際の高さに合わせて調整が必要です) */
        tr:nth-child(2) th,
        tr:nth-child(2) td {
            top: 20px;
        }

        /* 実際の表示の調整: th (ヘッダー) のセルをより目立たせる */
        th {
            background-color: #ddd;
            z-index: 11;
            /* thの方がtdより上に来るように */
        }

        /* 銘柄ごとの１行目の銘柄毎の集団項目*/
        .meigara-header-group {
            cursor: pointer;
            /* クリック可能であることを示す */
            color: initial;
        }

        .collapsed-detail-text {
            display: none;
        }

        .showed-detail-button {
            padding: 10px 20px;
            border: 1px solid #999;
            background: yellow;
        }

        .kuchisu-increase {
            font-weight: bold;
            /* 口数増加時は太字 */
            color: #27ae60;
        }

        .text-left {
            text-align: left;
        }

        .result-stats {
            margin-top: 20px;
            font-size: 1.1em;
            text-align: center;
        }

        /* 凡例のスタイル */
        #meigara-legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border: 1px solid #b3d4ff;
            border-radius: 5px;
            text-align: left;
            /* 左寄せ */
        }

        #meigara-legend h3 {
            margin-top: 0;
            font-size: 1.2em;
            color: #3498db;
        }

        /* グラフコンテナのスタイル */
        #chart-container {
            position: absolute;
            /* 絶対位置指定に変更 */
            display: none;
            /* 初期状態は非表示 */
            width: 600px;
            /* グラフの幅を指定 (調整可能) */
            max-width: 90%;
            /* 画面幅に応じた最大幅 */
            min-height: 350px;
            background-color: white;
            /* 背景色を追加 */
            border: 1px solid #ccc;
            /* 境界線を追加 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* 影を追加 */
            z-index: 100;
            /* 他の要素より手前に表示 */
            cursor: pointer;
            /* クリック可能を示すカーソル */
            padding: 10px;
            /* 内側の余白 */
            box-sizing: border-box;
            /* paddingを含めて幅計算 */
        }

        /* シミュレーション詳細セクションは常に表示しておく (テーブル用) */
        #simulation-detail {
            display: block;
            /* テーブル部分は常に表示 */
        }
    </style>
</head>

<body>
    <header>
        <h1>FIREシミュレーション結果</h1>
        <a href="index.html" class="nav-button" style="display: block; width: 200px; margin: 0 auto 20px;">メイン画面に戻る</a>
    </header>

    <main>
        <section id="results-summary">
            <h2>シミュレーション結果の概要</h2>
            <div class="result-stats">
                <p id="summary-text">データ読み込み中...</p>
            </div>

            <div class="filter-controls" style="text-align: center; margin-bottom: 20px;">
                <label for="failure-filter">
                    <input type="checkbox" id="failure-filter"> 失敗したケースのみ表示
                </label>
            </div>

            <div id="simulation-buttons" class="simulation-buttons">
            </div>
        </section>

        <section id="simulation-detail" style="display: none;">
            <h2 id="detail-title" style="text-align: left;">シミュレーション詳細（試行 #1）</h2>
            <div id="chart-container" style="width: 95%; margin: 30px auto; min-height: 350px; cursor: pointer;">
                <canvas id="totalAssetChart"></canvas>
            </div>

            <div id="meigara-legend">
                <h3>凡例</h3>
            </div>

            <div id="detail-table-container">
                <table id="detail-table">
                    <thead>
                        <tr id="header-row-1">
                            <th class="text-left" id="header-row-1-month" rowspan="2">(1)<br>年月</th>
                        </tr>
                        <tr id="header-row-2">
                            <th>(2) 引継<br>金融資産額</th>
                            <th>(3) 出費</th>
                            <th>(4) 収入</th>
                            <th>(5) 税金</th>
                            <th>(6) 保有現金</th>
                            <th>(7) 追加投資</th>
                            <th>(8) 期末<br>金融資産額</th>
                            <th>(9) 総資産</th>
                        </tr>
                    </thead>
                    <tbody id="detail-table-body">
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script src="app.js"></script>
    <script src="chart.min.js"></script>
    <script src="simulate-logic.js"></script>
</body>

</html>