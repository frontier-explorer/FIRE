const appData={config:{period:20,times:100,birthDate:"2000-01-01",cash:0,inflationRate:2},stocks:[],soukan:[],tuika:[],lifeCost:[],bigExpense:[],income:[],tax:[],exchangerage:[],dividend_setting:[]};window.appData=appData;const storedData=localStorage.getItem("fireSimulatorData");if(storedData)try{const t=JSON.parse(storedData);Object.keys(t).forEach(e=>{appData[e]=t[e]})}catch(t){}function downloadAllSettings(t="FIRE_Settings_Export.json"){const e=localStorage.getItem("fireSimulatorData");if(!e)return void alert("\u4fdd\u5b58\u3055\u308c\u305f\u8a2d\u5b9a\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u307e\u305a\u5404\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const appData=JSON.parse(e),a=JSON.stringify(appData,null,2),o=new Blob([a],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(o),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),alert("\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08"+t+"\uff09\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002")}function loadAllSettings(){const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=t=>{const e=t.target.files[0];if(!e)return;const a=new FileReader;a.onload=t=>{try{const e=t.target.result,a=JSON.parse(e);if(!a||"object"!=typeof a||!a.config)return void alert("\u30a8\u30e9\u30fc: \u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002FIRE\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");localStorage.setItem("fireSimulatorData",JSON.stringify(a)),alert("\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u3001Local Storage\u306b\u4fdd\u5b58\u3057\u307e\u3057\u305f\uff01\n\u5404\u8a2d\u5b9a\u753b\u9762\u3067\u5185\u5bb9\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002"),window.location.reload()}catch(t){alert("\u30d5\u30a1\u30a4\u30eb\u306e\u89e3\u6790\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30d5\u30a1\u30a4\u30eb\u304c\u7834\u640d\u3057\u3066\u3044\u308b\u304b\u3001JSON\u5f62\u5f0f\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002")}},a.readAsText(e)},t.click()}window.downloadAllSettings=downloadAllSettings,window.formatNumber=t=>{if(null==t)return"-";return Math.round(t).toLocaleString()},window.formatNumberInput=t=>{let e=t.target.value;if(e=e.replace(/,/g,""),isNaN(e)||""===e)return void(t.target.value=e);const a=e.replace(/\B(?=(\d{3})+(?!\d))/g,",");t.target.value=a},window.formatMonthToYearMonth=t=>{if(null==t)return"---";return`${Math.floor(t/12)}\u5e74${t%12+1}\u6708`},window.compareMonthAndGetCurrent=t=>{const e=new Date,a=e.getFullYear(),o=e.getMonth()+1,n=t.split("-");if(2!==n.length)throw new Error("\u5f15\u6570\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059\u3002'yyyy-mm' \u5f62\u5f0f\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const r=parseInt(n[0],10),i=parseInt(n[1],10);if(isNaN(r)||isNaN(i)||i<1||i>12)throw new Error("\u5f15\u6570\u306e\u5e74\u6708\u304c\u4e0d\u6b63\u306a\u5024\u3092\u542b\u3093\u3067\u3044\u307e\u3059\u3002");const l=12*a+o,c=12*r+i;if(l>c)return-1;return c-l},window.isValidDateRange=(t,e)=>{const a=!t||""===t.trim(),o=!e||""===e.trim(),n=e&&""!==e.trim();if(a&&o)return!1;if(a&&n)return!1;if(!a&&n){if(new Date(`${t}-01`)>new Date(`${e}-01`))return!1}return!0},document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("saveButton"),e=document.getElementById("loadButton");t&&t.addEventListener("click",()=>{try{localStorage.setItem("fireSimulatorData",JSON.stringify(appData)),alert("\u8a2d\u5b9a\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3057\u305f\uff01")}catch(t){alert("\u8a2d\u5b9a\u306e\u4fdd\u5b58\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}}),e&&e.addEventListener("click",()=>{try{const t=localStorage.getItem("fireSimulatorData");if(t){const e=JSON.parse(t);Object.keys(e).forEach(t=>{appData[t]=e[t]}),alert("\u8a2d\u5b9a\u304c\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3057\u305f\uff01"),window.loadConfig&&window.loadConfig(),window.loadStocks&&window.loadStocks()}else alert("\u4fdd\u5b58\u3055\u308c\u305f\u8a2d\u5b9a\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}catch(t){alert("\u8a2d\u5b9a\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}})});